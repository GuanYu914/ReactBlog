(this["webpackJsonpreact-router"]=this["webpackJsonpreact-router"]||[]).push([[0],{39:function(t,e,n){"use strict";n.r(e);var c,o,r,i,s,a=n(0),j=n.n(a),u=n(17),b=n.n(u),d=n(2),l=n(3),p=n(12),f=n(4),O=n(15),h="token",x=function(t){window.localStorage.setItem(h,t)},g=function(){return window.localStorage.getItem(h)},v="https://student-json-api.lidemy.me",m=Object(O.b)({name:"user",initialState:{name:null,errMsg:null},reducers:{setUser:function(t,e){t.name=e.payload},setErrMsg:function(t,e){t.errMsg=e.payload}}}),y=function(){return function(t){null!==g()&&function(){var t=g();return fetch("".concat(v,"/me"),{headers:{authorization:"Bearer ".concat(t)}}).then((function(t){return t.json()}))}().then((function(e){e.ok?(t(k(null)),t(P(e.data))):t(k(e.toString()))}))}},w=function(t){return function(e){var n,c;(n=t.username,c=t.password,fetch("".concat(v,"/login"),{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({username:n,password:c})}).then((function(t){return t.json()}))).then((function(t){t.ok?(x(t.token),e(y())):e(k(t.message))}))}},S=m.actions,P=S.setUser,k=S.setErrMsg,E=m.reducer,z=n(6),I=n(1),L=l.a.div(c||(c=Object(d.a)(["\n  height: 64px;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  border-bottom: 1px solid rgba(0, 0, 0, 0.2);\n  padding: 0px 32px;\n"]))),D=l.a.div(o||(o=Object(d.a)(["\n  font-size: 24px;\n  font-weight: bold;\n"]))),M=l.a.div(r||(r=Object(d.a)(["\n  display: flex;\n  align-items: center;\n"]))),B=l.a.div(i||(i=Object(d.a)(["\n  display: flex;\n  align-items: center;\n\n  "," {\n    margin-left: 32px;\n  }\n"])),M),C=Object(l.a)(p.b)(s||(s=Object(d.a)(["\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: 64px;\n  width: 128px;\n  font-weight: bold;\n  cursor: pointer;\n  color: black;\n  text-decoration: none;\n\n  ","\n"])),(function(t){return t.$active&&"\n    background: rgba(0, 0, 0, 0.2);\n  "}));var R,J,N,T,$,A=function(){var t=Object(f.g)(),e=Object(z.b)(),n=Object(z.c)((function(t){return t.user.name}));return Object(I.jsxs)(L,{children:[Object(I.jsxs)(B,{children:[Object(I.jsx)(D,{children:"\u6211\u7684\u7b2c\u4e00\u500b\u90e8\u843d\u683c"}),Object(I.jsxs)(M,{children:[Object(I.jsx)(C,{to:"/",$active:"/"===t.pathname,children:"\u9996\u9801"}),n&&Object(I.jsx)(C,{to:"new-post",$active:"/new-post"===t.pathname,children:"\u767c\u4f48\u6587\u7ae0"})]})]}),Object(I.jsxs)("div",{children:[!n&&Object(I.jsx)(C,{to:"login",$active:"/login"===t.pathname,children:"\u767b\u5165"}),n&&Object(I.jsx)(C,{to:"/",onClick:function(){x(null),e(P(null))},children:"\u767b\u51fa"})]})]})},q=n(11),U=l.a.div(R||(R=Object(d.a)([""]))),_=l.a.div(J||(J=Object(d.a)(["\n  border-bottom: 1px solid rgba(0, 0, 0, 0.2);\n  padding: 16px;\n  display: flex;\n  align-items: flex-end;\n  justify-content: space-between;\n"]))),F=Object(l.a)(p.b)(N||(N=Object(d.a)(["\n  font-size: 24px;\n  text-decoration: none;\n  color: black;\n"]))),H=l.a.div(T||(T=Object(d.a)(["\n  color: rgba(0, 0, 0, 0.8);\n"])));function G(t){var e=t.post;return Object(I.jsxs)(_,{children:[Object(I.jsx)(F,{to:"/posts/".concat(e.id),children:e.title}),Object(I.jsx)(H,{children:new Date(e.createdAt).toLocaleString()})]})}function K(){var t=Object(a.useState)([]),e=Object(q.a)(t,2),n=e[0],c=e[1];return Object(a.useEffect)((function(){fetch("".concat(v,"/posts?_sort=createdAt&_order=desc")).then((function(t){return t.json()})).then((function(t){return c(t)}))}),[]),Object(I.jsx)(U,{children:n.map((function(t){return Object(I.jsx)(G,{post:t},t.id)}))})}var Q=l.a.div($||($=Object(d.a)(["\n  color: red;\n"])));function V(){var t=Object(a.useState)(""),e=Object(q.a)(t,2),n=e[0],c=e[1],o=Object(a.useState)(""),r=Object(q.a)(o,2),i=r[0],s=r[1],j=Object(f.f)(),u=Object(z.b)(),b=Object(z.c)((function(t){return t.user.name})),d=Object(z.c)((function(t){return t.user.errMsg}));return Object(a.useEffect)((function(){b&&j.push("/")}),[b]),Object(a.useEffect)((function(){return function(){u(k(null))}}),[k]),Object(I.jsxs)("form",{onSubmit:function(t){t.preventDefault(),u(w({username:n,password:i}))},children:[Object(I.jsxs)("div",{children:["username: ",Object(I.jsx)("input",{value:n,onChange:function(t){c(t.target.value)}})]}),Object(I.jsxs)("div",{children:["password:"," ",Object(I.jsx)("input",{type:"password",value:i,onChange:function(t){s(t.target.value)}})]}),Object(I.jsx)("input",{type:"submit",value:"\u767b\u5165"}),d&&Object(I.jsx)(Q,{children:d})]})}var W,X,Y,Z,tt,et,nt,ct,ot,rt,it=Object(O.b)({name:"posts",initialState:{isLoadingPost:!0,post:null,newPostResp:null},reducers:{setIsLoadingPost:function(t,e){t.isLoadingPost=e.payload},setPost:function(t,e){t.post=e.payload},setNewPostResp:function(t,e){t.newPostResp=e.payload}}}),st=function(t){return function(e){e(ut(!0)),function(t){return fetch("".concat(v,"/posts?id=").concat(t)).then((function(t){return t.json()}))}(t).then((function(t){e(bt(t)),e(ut(!1))})).catch((function(){e(ut(!0)),console.log("error occur when get post")}))}},at=function(t){return function(e){(function(t,e){var n=g();return fetch("".concat(v,"/posts"),{method:"POST",headers:{"content-type":"application/json",authorization:"Bearer ".concat(n)},body:JSON.stringify({title:t,body:e})}).then((function(t){return t.json()}))})(t.postTitle,t.postBody).then((function(t){e(dt(t))}))}},jt=it.actions,ut=jt.setIsLoadingPost,bt=jt.setPost,dt=jt.setNewPostResp,lt=it.reducer,pt=l.a.div(W||(W=Object(d.a)(["\n  margin-top: 40px;\n  padding: 10px 20px;\n"]))),ft=l.a.div(X||(X=Object(d.a)(["\n  display: flex;\n  justify-content: flex-start;\n  align-items: flex-end;\n  margin-bottom: 50px;\n"]))),Ot=l.a.div(Y||(Y=Object(d.a)(["\n  font-size: 40px;\n  font-weight: bold;\n"]))),ht=l.a.div(Z||(Z=Object(d.a)(["\n  margin-left: 30px;\n  font-size: 12px;\n"]))),xt=l.a.div(tt||(tt=Object(d.a)(["\n  font-size: 18px;\n"])));function gt(t){var e=t.post;return Object(I.jsxs)(pt,{children:[Object(I.jsxs)(ft,{children:[Object(I.jsx)(Ot,{children:e.title}),Object(I.jsx)(ht,{children:new Date(e.createdAt).toLocaleString()})]}),Object(I.jsx)(xt,{children:e.body})]})}function vt(){var t=Object(f.h)().postID,e=Object(z.b)(),n=Object(z.c)((function(t){return t.posts.isLoadingPost})),c=Object(z.c)((function(t){return t.posts.post}));return Object(a.useEffect)((function(){e(st(t))}),[t]),Object(I.jsx)("div",{children:!n&&Object(I.jsx)(I.Fragment,{children:c.map((function(t){return Object(I.jsx)(gt,{post:t},1)}))})})}var mt,yt=l.a.div(et||(et=Object(d.a)([""]))),wt=l.a.form(nt||(nt=Object(d.a)([""]))),St=l.a.input(ct||(ct=Object(d.a)(["\n  display: block;\n  margin-top: 12px;\n"]))),Pt=l.a.textarea(ot||(ot=Object(d.a)(["\n  display: block;\n  margin-top: 12px;\n"]))),kt=l.a.input(rt||(rt=Object(d.a)(["\n  margin-top: 16px;\n"])));function Et(){var t=Object(a.useState)(""),e=Object(q.a)(t,2),n=e[0],c=e[1],o=Object(a.useState)(""),r=Object(q.a)(o,2),i=r[0],s=r[1],j=Object(f.f)(),u=Object(z.b)(),b=Object(z.c)((function(t){return t.posts.newPostResp}));return Object(a.useEffect)((function(){return b&&b.id&&j.push("/posts/"+b.id),function(){u(dt(null))}}),[b,j]),Object(I.jsx)(yt,{children:Object(I.jsxs)(wt,{onSubmit:function(t){t.preventDefault(),u(at({postTitle:n,postBody:i}))},children:[Object(I.jsx)("h2",{children:"\u767c\u4f48\u524d\u8acb\u5148\u4e09\u601d..."}),Object(I.jsx)(St,{required:!0,value:n,onChange:function(t){c(t.target.value)},placeholder:"\u8acb\u8f38\u5165\u6a19\u984c\u540d\u7a31"}),Object(I.jsx)(Pt,{required:!0,value:i,onChange:function(t){s(t.target.value)},rows:"10",cols:"30",placeholder:"\u8acb\u8f38\u5165\u5167\u5bb9..."}),Object(I.jsx)(kt,{type:"submit"})]})})}var zt=l.a.div(mt||(mt=Object(d.a)(["\n  padding-top: 64px;\n"])));var It=function(){var t=Object(z.b)();return Object(a.useEffect)((function(){t(y())}),[]),Object(I.jsx)(zt,{children:Object(I.jsxs)(p.a,{children:[Object(I.jsx)(A,{children:"Header"}),Object(I.jsxs)(f.c,{children:[Object(I.jsx)(f.a,{exact:!0,path:"/",children:Object(I.jsx)(K,{})}),Object(I.jsx)(f.a,{path:"/login",children:Object(I.jsx)(V,{})}),Object(I.jsx)(f.a,{path:"/posts/:postID",children:Object(I.jsx)(vt,{})}),Object(I.jsx)(f.a,{path:"/new-post",children:Object(I.jsx)(Et,{})})]})]})})},Lt=Object(O.a)({reducer:{posts:lt,user:E}});b.a.render(Object(I.jsx)(j.a.StrictMode,{children:Object(I.jsx)(z.a,{store:Lt,children:Object(I.jsx)(It,{})})}),document.getElementById("root"))}},[[39,1,2]]]);
//# sourceMappingURL=main.bbe4c03b.chunk.js.map